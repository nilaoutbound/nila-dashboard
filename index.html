<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging-compat.js"></script>

<script>
  // Konfigurasi Firebase yang kamu copy tadi
  const firebaseConfig = {
    apiKey: "AIzaSy...",
    // ... isi sisanya
  };
  firebase.initializeApp(firebaseConfig);
  const messaging = firebase.messaging();

  // Daftarkan Service Worker Baru (firebase-messaging-sw.js)
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./firebase-messaging-sw.js')
      .then((registration) => {
        console.log("Firebase SW Terdaftar");
      });
  }

  function mintaIzin() {
    Notification.requestPermission().then(perm => {
      if (perm === 'granted') {
        // Ambil Token untuk dikirim ke Google Sheets
        messaging.getToken({ 
          vapidKey: 'KUNCI_VAPID_YANG_KAMU_GENERATE_TADI' 
        }).then((currentToken) => {
          if (currentToken) {
            console.log("Token ditemukan:", currentToken);
            
            // KIRIM TOKEN KE IFRAME (Agar Apps Script bisa menyimpannya)
            const iframe = document.querySelector('iframe');
            iframe.contentWindow.postMessage({
              type: 'SIMPAN_TOKEN',
              token: currentToken
            }, '*');

            alert("Notifikasi Push Aktif!");
            document.getElementById('notif-btn').style.display = 'none';
          }
        });
      }
    });
  }
</script>
